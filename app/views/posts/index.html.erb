<body class="index">
<% @posts.each_with_index do |post, i| %>
  <div class="grid-10">
  <div class="thumbnail">
   <table>
    <tr>
    <td>
   <div class="image" style="background-image: url(<%= post.user.avatar.url(:thumb) %>);"></div>
 </td>
 <td>
   <p><%= post.user.nickname %>さん</p>
 </td>
 </tr>
 </table>

   <p>曲名：<%= post.song_title %><br>アーティスト名：<%= post.singer %></p>
  <div iframe-content>
    <iframe class="embed-responsive-item" src="<%= post.youtube_url %>"></iframe>
  </div>
  <p><%= post.text %></p>

  <%= render partial: "likes/like", locals: { post: post, i: i} %>


  <% if user_signed_in? && post.user_id == current_user.id %>
  <%= link_to '編集', "/posts/#{post.id}/edit" %>
   <%= link_to '削除', "/posts/#{post.id}", method: :delete %>
  <% end %>
  <%= link_to '詳細', "/posts/#{post.id}" %>
  </div>
  </div>
<% end %>
<%= paginate(@posts) %>
<script>
  $(".like-button").on("click", function(){
    var heart = $(this).children('img');
    var heart_count = $(this).children('.like-sum');
    var post_id = $(this).children('img').attr('id');
    like_function($(this), heart, heart_count, post_id)
  });

function like_function(button, heart, heart_count, post_id){
  if (button.hasClass("decrement")){
    $.ajax({
      url: "/posts/" + post_id + "/unlike",
      type: "delete",
      data: {post_id: post_id}
    })
    .done(function(data){
      button.removeClass("decrement").addClass("increament")
      heart.attr("src", "/assets/icon_heart.svg")
      heart_count.text(data)
    });
    return false;
  }else{
    $.ajax({
      url: "/posts/" + post_id + "/like",
      type: "post",
      data: {post_id: post_id}
    })
    .done(function(data){
      button.removeClass("increment").addClass("decrement")
      heart.attr("src", "/assets/icon_red_heart.svg")
      heart_count.text(data)
    });
    return false;
  }
}
</script>

</body>
